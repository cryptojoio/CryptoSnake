<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>Crypto Snake Retro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel Standalone (Compiles JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
      body {
        font-family: 'VT323', monospace;
        background-color: #202020;
        overflow: hidden;
        user-select: none;
        -webkit-user-select: none;
      }
      .pixel-shadow {
        box-shadow: 4px 4px 0px 0px rgba(0,0,0,0.3);
      }
      .inset-shadow {
        box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
      }
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      @keyframes progress {
        0% { width: 0% }
        100% { width: 100% }
      }
      .animate-progress { animation: progress 1s ease-in-out forwards; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "vite": "https://aistudiocdn.com/vite@^7.2.4",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel">
      const { useState, useEffect, useCallback, useRef } = React;

      // --- CONSTANTS ---
      const GRID_SIZE = 20;
      const INITIAL_SPEED = 220; 
      const SPEED_INCREMENT = 5; 
      const MIN_SPEED = 60; 

      // --- ICONS (Replaces Lucide-React to avoid dependencies) ---
      const Icon = ({ path, size = 24, className = "" }) => (
        <svg 
          width={size} 
          height={size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          className={className}
        >
          {path}
        </svg>
      );

      const Icons = {
        ArrowUp: <path d="m18 15-6-6-6 6"/>,
        ArrowDown: <path d="m6 9 6 6 6-6"/>,
        ArrowLeft: <path d="m15 18-6-6 6-6"/>,
        ArrowRight: <path d="m9 18 6-6-6-6"/>,
        Play: <polygon points="6 3 20 12 6 21 6 3" fill="currentColor" stroke="none"/>,
        Pause: <><rect x="6" y="4" width="4" height="16" fill="currentColor" stroke="none"/><rect x="14" y="4" width="4" height="16" fill="currentColor" stroke="none"/></>,
        Save: <><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-8H7v8"/><path d="M7 3v5h8"/></>,
        RotateCcw: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></>,
        Home: <><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>,
        Trophy: <><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>,
        ListOrdered: <><line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></>
      };

      const COINS = [
        {
          symbol: 'ETH',
          color: '#627EEA',
          svg: (
            <svg viewBox="0 0 32 32" className="w-full h-full" fill="currentColor">
              <path d="M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16-7.163 16-16 16zm7.994-15.781L16.498 4 9 16.22l7.498 4.353 7.496-4.354zM24 17.616l-7.502 4.351L9 17.617l7.498 10.378L24 17.616z" />
            </svg>
          ),
        },
        {
          symbol: 'DOGE',
          color: '#C2A633',
          svg: (
            <svg viewBox="0 0 32 32" className="w-full h-full" fill="currentColor">
              <path d="M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16-7.163 16-16 16zm4.063-20.938c-1.313 0-2.063.125-2.063.125v13.5s.813.25 2.125.25c4.688 0 7-3.25 7-6.938 0-3.625-2.375-6.937-7.063-6.937zm-4.688.125h-4.25v13.5h4.25V11.187z" />
            </svg>
          ),
        },
        {
          symbol: 'SOL',
          color: '#9945FF',
          svg: (
            <svg viewBox="0 0 32 32" className="w-full h-full" fill="currentColor">
               <path d="M4.625 9.125L8.563 5.5h18.812l-3.938 3.625H4.625zm0 13.75l3.938-3.625h18.812l-3.938 3.625H4.625zm18.812-10.313l-3.937 3.625H4.625l3.938-3.625h18.812z" />
            </svg>
          ),
        },
        {
          symbol: 'USDT',
          color: '#26A17B',
          svg: (
            <svg viewBox="0 0 32 32" className="w-full h-full" fill="currentColor">
              <path d="M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16-7.163 16-16 16zm2.366-18.428V11.52h4.742V8.406H8.89v3.113h4.743v2.053c-3.692.176-6.417 1.341-6.417 2.715 0 1.54 3.442 2.79 7.683 2.79V24.5h2.2v-5.422c4.241 0 7.683-1.25 7.683-2.79 0-1.374-2.725-2.54-6.417-2.716z" />
            </svg>
          ),
        }
      ];

      const BTC_ICON = (
        <svg viewBox="0 0 32 32" className="w-full h-full text-orange-500" fill="currentColor">
          <path d="M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16-7.163 16-16 16zm11.313-11.5c.563-3.75-2.313-5.188-4.938-5.75V11h-2.188V7.25h-3.5V11h-3.5V7.25h-3.5V11H6v3.5h3.5v10H6v3.5h3.687V32h3.5v-4h3.5v4h3.5v-4.25c5.938.375 10.438-2.375 10.125-7.25zM15.5 15.25h3.25c2.063 0 2.25 1.5.125 1.5H15.5v-1.5zm.063 7.75v-1.75h4.625c2.188 0 2.188 1.75 0 1.75H15.562z" />
        </svg>
      );

      // --- COMPONENTS ---

      const DPad = ({ onDirection, onPause, isPaused }) => {
        const handlePress = (d) => {
          if (!isPaused) {
            onDirection(d);
          }
        };

        return (
          <div className="relative w-40 h-40 mx-auto mt-6 select-none">
            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-14 bg-stone-800 rounded-t-lg active:bg-stone-700 active:scale-95 transition-transform pixel-shadow flex items-center justify-center cursor-pointer tap-highlight-transparent"
                 onClick={() => handlePress('UP')}>
                 <Icon path={Icons.ArrowUp} className="text-stone-500" />
            </div>
            <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-14 bg-stone-800 rounded-b-lg active:bg-stone-700 active:scale-95 transition-transform pixel-shadow flex items-center justify-center cursor-pointer tap-highlight-transparent"
                 onClick={() => handlePress('DOWN')}>
                 <Icon path={Icons.ArrowDown} className="text-stone-500" />
            </div>
            <div className="absolute left-0 top-1/2 -translate-y-1/2 w-14 h-12 bg-stone-800 rounded-l-lg active:bg-stone-700 active:scale-95 transition-transform pixel-shadow flex items-center justify-center cursor-pointer tap-highlight-transparent"
                 onClick={() => handlePress('LEFT')}>
                 <Icon path={Icons.ArrowLeft} className="text-stone-500" />
            </div>
            <div className="absolute right-0 top-1/2 -translate-y-1/2 w-14 h-12 bg-stone-800 rounded-r-lg active:bg-stone-700 active:scale-95 transition-transform pixel-shadow flex items-center justify-center cursor-pointer tap-highlight-transparent"
                 onClick={() => handlePress('RIGHT')}>
                 <Icon path={Icons.ArrowRight} className="text-stone-500" />
            </div>
            
            <div 
              onClick={onPause}
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-stone-700 rounded-full inset-shadow flex items-center justify-center cursor-pointer active:scale-90 transition-transform z-10 border-4 border-stone-800 hover:bg-stone-600"
              title="Pause/Resume"
            >
              {isPaused ? <Icon path={Icons.Play} size={20} className="text-yellow-500 fill-current" /> : <Icon path={Icons.Pause} size={20} className="text-stone-400" />}
            </div>
          </div>
        );
      };

      const Screen = ({ children, isOn }) => (
        <div className={`w-full aspect-square bg-[#A4B494] border-8 border-stone-600 rounded-lg shadow-inner relative overflow-hidden transition-colors duration-500 ${!isOn ? 'brightness-50 grayscale' : ''}`}>
          <div className="w-full h-full p-2 font-mono text-[#0F380F] flex flex-col relative z-10">
            {children}
          </div>
        </div>
      );

      // --- MAIN APP ---

      // Audio System (Simplified for one file)
      const audioContextRef = { current: null };
      const playSound = (type, isMuted) => {
        if (isMuted) return;
        try {
          const AudioCtor = window.AudioContext || window.webkitAudioContext;
          if (!AudioCtor) return;
          if (!audioContextRef.current) {
            audioContextRef.current = new AudioCtor();
          }
          const ctx = audioContextRef.current;
          if (ctx.state === 'suspended') ctx.resume();

          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);

          if (type === 'eat') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1400, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
            osc.start();
            osc.stop(ctx.currentTime + 0.15);
          } else if (type === 'die') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, ctx.currentTime + 0.4);
            gain.gain.setValueAtTime(0.2, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
            osc.start();
            osc.stop(ctx.currentTime + 0.4);
          } else if (type === 'click') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(600, ctx.currentTime);
            gain.gain.setValueAtTime(0.05, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
            osc.start();
            osc.stop(ctx.currentTime + 0.05);
          }
        } catch (e) { console.error(e); }
      };

      function App() {
        const [status, setStatus] = useState('START'); // START, PLAYING, PAUSED, GAME_OVER, SAVING, LEADERBOARD
        const [score, setScore] = useState(0);
        const [snake, setSnake] = useState([{ x: 10, y: 10 }]);
        const [food, setFood] = useState({ x: 15, y: 15 });
        const [currentCoin, setCurrentCoin] = useState(COINS[0]);
        const [leaderboard, setLeaderboard] = useState([]);
        const [isMuted, setIsMuted] = useState(false);
        const [statusMessage, setStatusMessage] = useState('');
        
        const directionRef = useRef('RIGHT');
        const moveQueue = useRef([]); 
        const speedRef = useRef(INITIAL_SPEED);
        const gameIntervalRef = useRef(null);

        useEffect(() => {
          const saved = localStorage.getItem('crypto_snake_leaderboard');
          if (saved) setLeaderboard(JSON.parse(saved));
        }, []);

        useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === 'Escape') setStatus('START');
            
            if (e.code === 'Space' && (status === 'PLAYING' || status === 'PAUSED')) {
              e.preventDefault();
              togglePause();
              return;
            }

            if (status !== 'PLAYING') return;

            switch (e.key) {
              case 'ArrowUp': e.preventDefault(); queueMove('UP'); break;
              case 'ArrowDown': e.preventDefault(); queueMove('DOWN'); break;
              case 'ArrowLeft': e.preventDefault(); queueMove('LEFT'); break;
              case 'ArrowRight': e.preventDefault(); queueMove('RIGHT'); break;
            }
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [status]);

        const saveScore = () => {
          playSound('click', isMuted);
          setStatus('SAVING');
          setStatusMessage("Saving Score...");

          setTimeout(() => {
            const newRecord = {
              id: Math.random().toString(36).substr(2, 9),
              score,
              timestamp: Date.now(),
            };

            const newLeaderboard = [...leaderboard, newRecord].sort((a, b) => b.score - a.score).slice(0, 10);
            setLeaderboard(newLeaderboard);
            localStorage.setItem('crypto_snake_leaderboard', JSON.stringify(newLeaderboard));
            
            playSound('eat', isMuted);
            setStatus('LEADERBOARD');
          }, 1000);
        };

        const togglePause = () => {
          playSound('click', isMuted);
          if (status === 'PLAYING') setStatus('PAUSED');
          else if (status === 'PAUSED') setStatus('PLAYING');
        };

        const isOpposite = (d1, d2) => {
          return (d1 === 'UP' && d2 === 'DOWN') ||
                 (d1 === 'DOWN' && d2 === 'UP') ||
                 (d1 === 'LEFT' && d2 === 'RIGHT') ||
                 (d1 === 'RIGHT' && d2 === 'LEFT');
        };

        const queueMove = (newDir) => {
          const lastScheduledMove = moveQueue.current.length > 0 
            ? moveQueue.current[moveQueue.current.length - 1] 
            : directionRef.current;

          if (isOpposite(newDir, lastScheduledMove)) return;
          if (newDir === lastScheduledMove) return;

          playSound('click', isMuted);
          moveQueue.current.push(newDir);
        };

        const spawnFood = () => {
          const newX = Math.floor(Math.random() * GRID_SIZE);
          const newY = Math.floor(Math.random() * GRID_SIZE);
          setFood({ x: newX, y: newY });
          const randIndex = Math.floor(Math.random() * COINS.length);
          setCurrentCoin(COINS[randIndex]);
        };

        const gameOver = () => {
          playSound('die', isMuted);
          if (gameIntervalRef.current) clearInterval(gameIntervalRef.current);
          setStatus('GAME_OVER');
        };

        const gameLoop = useCallback(() => {
          setSnake((prevSnake) => {
            if (moveQueue.current.length > 0) {
              const nextMove = moveQueue.current.shift();
              if (nextMove) directionRef.current = nextMove;
            }

            const currentDir = directionRef.current;
            const head = prevSnake[0];
            const newHead = { ...head };

            switch (currentDir) {
              case 'UP': newHead.y -= 1; break;
              case 'DOWN': newHead.y += 1; break;
              case 'LEFT': newHead.x -= 1; break;
              case 'RIGHT': newHead.x += 1; break;
            }

            if (newHead.x < 0 || newHead.x >= GRID_SIZE || newHead.y < 0 || newHead.y >= GRID_SIZE) {
              gameOver();
              return prevSnake;
            }

            if (prevSnake.some(seg => seg.x === newHead.x && seg.y === newHead.y)) {
              gameOver();
              return prevSnake;
            }

            const newSnake = [newHead, ...prevSnake];

            if (newHead.x === food.x && newHead.y === food.y) {
              playSound('eat', isMuted);
              setScore(s => s + 10);
              speedRef.current = Math.max(MIN_SPEED, speedRef.current - SPEED_INCREMENT);
              spawnFood();
            } else {
              newSnake.pop();
            }

            return newSnake;
          });
        }, [food, isMuted]);

        useEffect(() => {
          if (status === 'PLAYING') {
            if (gameIntervalRef.current) clearInterval(gameIntervalRef.current);
            gameIntervalRef.current = window.setInterval(gameLoop, speedRef.current);
          } else {
            if (gameIntervalRef.current) clearInterval(gameIntervalRef.current);
          }
          return () => {
            if (gameIntervalRef.current) clearInterval(gameIntervalRef.current);
          };
        }, [status, gameLoop]); 

        const resetGame = () => {
          playSound('click', isMuted);
          setSnake([{ x: 10, y: 10 }]);
          setScore(0);
          directionRef.current = 'RIGHT';
          moveQueue.current = [];
          speedRef.current = INITIAL_SPEED;
          spawnFood();
          setStatus('PLAYING');
        };

        const goHome = () => {
          playSound('click', isMuted);
          setStatus('START');
          setStatusMessage("");
        };

        const goToLeaderboard = () => {
          playSound('click', isMuted);
          setStatus('LEADERBOARD');
        };

        // --- RENDERERS ---
        const CELL_PCT = 100 / GRID_SIZE;

        const RenderGameLayers = () => (
          <div className="relative w-full h-full border-2 border-[#0F380F]/30 bg-[#A4B494] overflow-hidden">
            <div 
              className="absolute inset-0 z-0 pointer-events-none"
              style={{
                backgroundImage: `
                  linear-gradient(to right, #0F380F20 1px, transparent 1px),
                  linear-gradient(to bottom, #0F380F20 1px, transparent 1px)
                `,
                backgroundSize: `${CELL_PCT}% ${CELL_PCT}%`
              }}
            />
            <div
              className="absolute z-10 animate-pulse transition-none"
              style={{
                left: `${food.x * CELL_PCT}%`,
                top: `${food.y * CELL_PCT}%`,
                width: `${CELL_PCT}%`,
                height: `${CELL_PCT}%`
              }}
            >
              {currentCoin.svg}
            </div>
            {snake.map((segment, i) => {
              const isHead = i === 0;
              return (
                <div
                  key={i}
                  className={`absolute transition-none ${isHead ? 'z-20' : 'z-10'}`}
                  style={{
                    left: `${segment.x * CELL_PCT}%`,
                    top: `${segment.y * CELL_PCT}%`,
                    width: `${CELL_PCT}%`,
                    height: `${CELL_PCT}%`
                  }}
                >
                  <div className="w-full h-full" style={{ opacity: isHead ? 1 : Math.max(0.6, 1 - i / (snake.length + 10)) }}>
                    {BTC_ICON}
                  </div>
                </div>
              );
            })}
            {status === 'PAUSED' && (
              <div className="absolute inset-0 z-50 flex items-center justify-center bg-[#A4B494]/80 backdrop-blur-sm">
                <div className="bg-[#0F380F] text-[#A4B494] px-4 py-2 font-bold animate-pulse text-xl">
                  PAUSED
                </div>
              </div>
            )}
          </div>
        );

        return (
          <div className="min-h-screen bg-stone-900 flex items-center justify-center p-2 md:p-4 overflow-hidden">
            <div className="relative bg-stone-200 p-2 md:p-6 rounded-b-3xl rounded-t-2xl pixel-shadow w-full max-w-xl flex flex-col items-center border-l-8 border-r-8 border-t-4 border-b-8 border-stone-300">
              
              <div className="w-full flex justify-between items-center mb-3 px-2">
                 <div className="h-2 md:h-3 w-full border-b-4 border-stone-300"></div>
                 <span className="text-stone-400 font-bold italic ml-2 text-xs md:text-sm whitespace-nowrap">GAME-CONSOLE v2.0</span>
              </div>

              <div className="bg-stone-500 p-3 md:p-6 rounded-t-lg rounded-b-2xl w-full shadow-lg relative">
                
                <div className="flex justify-end items-end mb-1 px-1">
                  <button 
                    onClick={() => setIsMuted(!isMuted)}
                    className="flex items-center gap-1 cursor-pointer group"
                    title="Toggle Sound"
                  >
                    <span className="text-[10px] text-stone-300">SOUND</span>
                    <div className={`w-8 h-4 rounded-full p-0.5 flex items-center transition-colors ${isMuted ? 'bg-stone-700' : 'bg-green-600'}`}>
                       <div className={`w-3 h-3 bg-stone-200 rounded-full shadow-sm transform transition-transform ${isMuted ? 'translate-x-0' : 'translate-x-4'}`}></div>
                    </div>
                  </button>
                </div>
                
                <Screen isOn={true}>
                  {status === 'START' && (
                    <div className="flex flex-col items-center justify-center h-full space-y-4 animate-in fade-in">
                      <div className="text-center">
                        <h1 className="text-4xl font-bold tracking-widest uppercase mb-1 text-center">Crypto</h1>
                        <h1 className="text-4xl font-bold tracking-widest uppercase mb-2 text-center">Snake</h1>
                      </div>
                      <div className="w-16 h-16 animate-bounce">{BTC_ICON}</div>
                      <div className="flex gap-2 mt-4">
                        <button 
                          onClick={resetGame}
                          className="px-6 py-2 bg-[#0F380F] text-[#A4B494] font-bold border-2 border-[#0F380F] hover:bg-[#205020] active:translate-y-1 text-xl"
                        >
                          PLAY
                        </button>
                      </div>
                    </div>
                  )}

                  {(status === 'PLAYING' || status === 'PAUSED') && (
                    <>
                       <div className="flex justify-between text-xs font-bold mb-1 border-b border-[#0F380F]/50 pb-1">
                          <span>SCORE: {score}</span>
                          <span>COIN: {currentCoin.symbol}</span>
                       </div>
                       <RenderGameLayers />
                    </>
                  )}

                  {status === 'GAME_OVER' && (
                    <div className="flex flex-col items-center justify-center h-full space-y-4">
                      <h2 className="text-4xl font-bold mb-2">GAME OVER</h2>
                      <div className="text-2xl">SCORE: {score}</div>
                      
                      <div className="flex flex-col gap-3 w-full max-w-[200px] mt-4">
                        <button 
                          onClick={saveScore}
                          className="flex items-center justify-center gap-2 px-4 py-3 bg-[#0F380F] text-[#A4B494] font-bold active:translate-y-1 hover:opacity-90 relative overflow-hidden"
                        >
                          <div className="absolute inset-0 bg-white/10 animate-pulse pointer-events-none" />
                          <Icon path={Icons.Save} size={18} /> SAVE SCORE
                        </button>
                        <button 
                          onClick={goHome}
                          className="flex items-center justify-center gap-2 px-4 py-3 border-2 border-[#0F380F] font-bold active:translate-y-1 hover:bg-[#0F380F]/10"
                        >
                          <Icon path={Icons.RotateCcw} size={18} /> HOME
                        </button>
                      </div>
                    </div>
                  )}

                  {status === 'SAVING' && (
                    <div className="flex flex-col items-center justify-center h-full space-y-6">
                      <div className="animate-pulse"><Icon path={Icons.Save} size={48} /></div>
                      <div className="text-center">
                        <h3 className="text-2xl font-bold">SAVING...</h3>
                        <p className="text-sm mt-2">{statusMessage}</p>
                      </div>
                      <div className="w-3/4 h-3 bg-[#0F380F]/30 rounded overflow-hidden">
                        <div className="h-full bg-[#0F380F] animate-progress"></div>
                      </div>
                    </div>
                  )}

                  {status === 'LEADERBOARD' && (
                    <div className="flex flex-col h-full w-full">
                      <div className="flex items-center justify-between border-b-2 border-[#0F380F] pb-2 mb-2">
                        <h2 className="text-xl font-bold flex items-center gap-2"><Icon path={Icons.Trophy} size={20}/> HIGH SCORES</h2>
                      </div>
                      <div className="flex-1 overflow-y-auto space-y-2 pr-1 scrollbar-hide">
                        {leaderboard.length === 0 ? (
                          <p className="text-center text-sm mt-10">No records yet.</p>
                        ) : (
                          leaderboard.map((rec, idx) => (
                            <div key={rec.id} className="flex justify-between items-center text-sm border-b border-[#0F380F]/20 pb-1">
                              <span className="font-bold w-6">{idx + 1}.</span>
                              <div className="flex-1 flex flex-col overflow-hidden mr-2">
                                   <span className="font-mono text-xs truncate opacity-70">
                                    {new Date(rec.timestamp).toLocaleDateString()}
                                  </span>
                              </div>
                              <span className="font-bold">{rec.score}</span>
                            </div>
                          ))
                        )}
                      </div>
                      <div className="mt-2 pt-2 border-t border-[#0F380F]">
                         <button onClick={goHome} className="w-full py-1 text-center font-bold hover:bg-[#0F380F]/10">
                           BACK TO HOME
                         </button>
                      </div>
                    </div>
                  )}
                </Screen>

                <div className="text-center mt-2 text-stone-300 text-xs italic font-serif">Portable Gaming System</div>
              </div>

              <div className="w-full mt-6 pb-4 md:pb-8 flex flex-col items-center relative">
                <div className="flex w-full justify-between items-end px-4 md:px-12">
                  
                  <div className="scale-110 md:scale-125 origin-bottom-left">
                     <DPad onDirection={queueMove} onPause={togglePause} isPaused={status === 'PAUSED'} />
                  </div>
                  
                  <div className="flex gap-4 rotate-12 mb-6 ml-4">
                    <div className="flex flex-col items-center gap-1">
                       <button 
                        onClick={goToLeaderboard}
                        className="w-14 h-14 bg-blue-600 rounded-full pixel-shadow active:bg-blue-700 active:translate-y-1 flex items-center justify-center text-stone-200"
                        aria-label="Leaderboard"
                      >
                        <Icon path={Icons.ListOrdered} size={28} />
                      </button>
                       <span className="text-stone-400 font-bold text-xs tracking-wider">RANK</span>
                    </div>
                    <div className="flex flex-col items-center gap-1 mt-6">
                      <button 
                        onClick={goHome}
                        className="w-14 h-14 bg-yellow-500 rounded-full pixel-shadow active:bg-yellow-600 active:translate-y-1 flex items-center justify-center text-stone-900"
                        aria-label="Home"
                      >
                        <Icon path={Icons.Home} size={28} />
                      </button>
                      <span className="text-stone-400 font-bold text-xs tracking-wider">HOME</span>
                    </div>
                  </div>
                </div>
                
                <div className="absolute bottom-2 right-8 flex gap-1 -rotate-12 opacity-50">
                  <div className="w-1 h-8 bg-stone-300 rounded-full inset-shadow"></div>
                  <div className="w-1 h-8 bg-stone-300 rounded-full inset-shadow"></div>
                  <div className="w-1 h-8 bg-stone-300 rounded-full inset-shadow"></div>
                  <div className="w-1 h-8 bg-stone-300 rounded-full inset-shadow"></div>
                </div>

              </div>

            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
